<div class="messages stopPropagation">
    <div class="container" >    
        <base href=" " />    

        <div class="message-top">
            <div class="inbox-top">
                Inbox
                <a class="button new-message" id="searchButton" href="">New PM</a>
            </div>
            <div class="chat-top">
                  <div class="chat-name" id="chatTitle"></div>
                  <button id="buttonCloseMessage" class="button-close">Ã—</button>
            </div>
        </div>


        {% verbatim %}
        <div class="message-bottom" >
            <div id="inboxBlock" ng-controller="inboxController as inbox" class="inbox">
                {% endverbatim %}{{ form(getCurrentUserForm) }}{% verbatim %}
                <ul class="list-mess">
                    <li ng-repeat="thread in currentUser.threadList track by $index" ng-if="thread.target.name" class="message" >                    
                        <a href="" ng-click="inbox.gotToConversation(thread)"  ng-class="{open: thread.id == currentUser.selectedThreadId}" >
                            <div class="avatar">
                                <img ng-src="{{ thread.target.image }}">
                            </div>
                            <div class="desc">
                                <div class="name">{{ thread.target.name }}</div>
                                <div class="last-message">
                                    <span ng-if="thread.lastMessage.messageFromUs">You: </span>
                                    {{ thread.lastMessage.content | limitTo: 24 }}
                                    <span ng-if="thread.lastMessage.content.length > 25">...</span>
                                </div>
                                <span class="dot new"></span>
                            </div>
                            <span ng-if="thread.haveNewMessage"></span>
                        </a>
                    </li>
                </ul>                        
            </div>

            <div id="searchBlock" ng-controller="searchController as search" class="search-box" style="display: none;">
                <form action="{% endverbatim %}{{ path('pp_user_api_get_search_user') }}{% verbatim %}" name="pp_user_api_get_search_user_form">
                    <input placeholder="Type an username here..." class="search-box-input" type="text" name="search" ng-model="search.search" ng-change="search.searchUser()"/>
                </form>                
                <ul>
                    <li ng-repeat="user in userSearchList" class="search-box-user">
                        <a href="" ng-click="search.getThread(user)">
                            <img class="avatar" ng-src="{{ user.image }}" />{{ user.name }}
                        </a>
                    </li>
                </ul>
            </div>

            <div ng-controller="chatController as chat" class="chat-container" >
                <div id="conversation" class="chat-conversation">
                    <div class="chat-scroller">
                        <a href="" class="chat-more" ng-click="chat.loadMore()">load more</a>
                        <div  ng-repeat="message in currentUser.threadList[currentThread.id].messageList" >
                            <div ng-if="message.messageFromUs" class="message me">
                                <div class="message-content" ng-bind-html="message.content | linky ">
                                    {{ message.content }}
                                </div>                         
                            </div>

                            <div ng-if="!message.messageFromUs" class="message">
                                <div class="message-content" ng-bind-html="message.content | linky ">
                                    {{ message.content }}
                                </div>
                                <div class="avatar" ng:class="{true:'avatar last', false:'avatar'}[!currentUser.threadList[currentThread.id].messageList[$index+1] || currentUser.threadList[currentThread.id].messageList[$index+1].messageFromUs]">
                                    <img ng-src="{{ message.author.image }}">
                                </div>
                            </div>
                        </div>
                        <div ng-show="!currentUser.threadList[currentThread.id].messageList.length">No message yet</div>
                    </div>
                </div>
                <div class="chat-composer">                    
                    <form>
                        <textarea  id="chatTextArea" placeholder="Type your text here ..."  name="message_value" ng-model="messageContent"></textarea>
                        <button type="submit" ng-click="chat.callSendMessage()">Send</button>
                    </form>
                </div>
            </div>
        </div>
        {% endverbatim %}

    </div>
</div>

