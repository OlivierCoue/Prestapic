{# src/OC/UserBundle/Resources/views/layout.html.twig #}

{# On ï¿½tend notre layout #}
{% extends "::layout.html.twig" %}

{% block title %}
    {{ pageProfile.name }}
{% endblock %}

{% block bellowHeader %}
<div id="profileApp" >
    <base href=" " />
    
    {# display profile header #}
    <section class="profile" ng-controller="profileController as profile" >
        <div id="profileHeaderContainer">
            <div class="banner">
                {% if pageProfile.coverImage != null %}
                    <img src="{{ asset(pageProfile.coverImage.webPath("1500x500")) }}" alt="{{ pageProfile.coverImage.alt }}">
                {% endif %}
                <div class="overlay"></div>
            </div>                
            <div class="profile-details">
                <a class="avatar"  href="#" title="">
                  <img src="{{ asset(pageProfile.profilImage.webPath("70x70")) }}" alt="{{ pageProfile.profilImage.alt }}">
                </a>
                <h1 class="username">{{ pageProfile.name }}</h1>
                <p class="bio">{{ pageProfile.description }}</p>
                {% if is_granted('ROLE_USER') %}
                    {% if isHownProfile == true %}
                        {{ form(editProfileForm) }}
                        <a id="editButton" class="button follow" ng-click="profile.getEditProfileForm()" >
                            Edit profile
                        </a>
                    {% else %}
                        {{ form(followForm) }}
                        {% if is_granted("ROLE_ADMIN") %}
                            {{ form(setModeratorForm) }}
                        {% endif %}
                        <a id="followButton" class="button follow" ng-click="profile.patchFollow()" >
                            {% if isFollowing == true %}
                                unfollow
                            {% else %}
                                follow
                            {% endif %}
                        </a>
                    {% endif %}
                {% endif %}
                {% if is_granted("ROLE_ADMIN") and isHownProfile == false %}                    
                        <a id="setModeratorButton" class="button follow" ng-click="profile.patchModerator({{ pageProfile.id }})">{% if isModerator == true %}unset moderator{% else %}Set moderator{% endif %}</a>
                {% endif %}   

                <ul class="details">
                    <li>
                        <strong>Following</strong>
                        {% if pageProfile.followingNb != null %}{{ pageProfile.followingNb }}{% else %}0{% endif %}
                    </li>
                    <li>
                        <strong>Followers</strong>
                        {% if pageProfile.followersNb != null %}{{ pageProfile.followersNb }}{% else %}0{% endif %}
                    </li>                                                         
                    <li class="link">
                        <a href="#" title="">{{ pageProfile.contact }}</a>                    
                    </li>
                </ul>
            </div>
        </div>
        <div id="editProfilContainer"></div>
    </section>
    
    {# display galery #}
    <section class="galery">        
        <div class="content">
            <h1>Gallery ({{ galleryImagesNb }} pictures)</h1>
            {% set break = false %}
            <ul>
            {% for proposition in galleryImages if not break %}
                <li>
                    <a href="{{ path('pp_request_view', {'slug':proposition.imageRequest.slug, 'page': 1 }) }}"><img src="{{ asset(proposition.image.webPath("380x260")) }}" alt="{{ proposition.image.alt }}"></a>                    
                </li>
               {% if loop.index >= 4  %}{% set break = true %}{% endif %}
               {% if loop.index >= 3 and galleryImagesNb > 4 %}{% set break = true %}{% endif %}
            {% endfor %}

            {% if galleryImagesNb > 4  %}
                <li>
                    <a href="" class="more">                    
                        +{{ galleryImagesNb-3 }}             
                    </a>
                </li>
            {% endif %}
            </ul>
        </div>
    </section>
{% endblock %}

{% block body %}   
    <div class="demand-list" > 
        
        {% if isHownProfile == true %}{{ include("PPRequestBundle:Request:addRequestForm.html.twig") }}{% endif %}
        
        <div ng-controller="requestsController as requests" ng-init="requests.init({{ pageProfile.id }})" >
            
            {{ form(loadRequestForm) }}
            {{ form(upvoteRequestForm) }}
            <div id="loadPage1"> </div>
            
            <div class="load-content"  id="loadingGif" >
                <span class="bubble"></span>
            </div>
        </div>
    </div>
{% endblock %}


{% block js %}
    {% javascripts filter='?yui_js' '@PPUserBundle/Resources/public/js/profileApp.js' %}
      <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}    
{% endblock %}