var headerApp=angular.module("headerApp",[]);headerApp.config(["$locationProvider",function(a){a.html5Mode(true)}]);headerApp.service("FayeClient",function(){return new Faye.Client("http://localhost:3000/")});headerApp.run(["$rootScope","FayeClient","$http",function(a,e,f){a.notifications=[];var d=document.forms.pp_notification_api_get_thread_form;if(d!=null){var b=d.action;var c=null;f.get(b).then(function(g){var h=JSON.parse(g.data);c=h.notifThreadSlug;e.subscribe("/notification/"+c,function(i){a.$broadcast("notification",i)})},function(g){console.log("Request failed : "+g.statusText)})}}]);headerApp.filter("reverse",function(){return function(a){return a.slice().reverse()}});var notificationListIsOpen=false;var userMenuIsOpen=false;var filterListIsOpen=false;var haveOpenMessage=false;var messageIsOpen=false;headerApp.controller("headerController",["$scope","$http","$compile","$location","$window",function(m,k,e,h,c){var l=false;var j=null;m.showMoreNotification=true;var d=function(){if(messageIsOpen){b()}if(notificationListIsOpen){i()}if(filterListIsOpen){f()}if(userMenuIsOpen){a()}};this.showMessage=function(){d();var n=document.getElementById("messageApp");if(n!=null){g(true);if(!haveOpenMessage){angular.element(document).ready(function(){angular.bootstrap(n,["messageApp"])});haveOpenMessage=true}n.style.display="block";messageIsOpen=true}};var b=function(){if(document.getElementById("messageApp")!=null){document.getElementById("messageApp").style.display="none"}g(false);messageIsOpen=false};var g=function(p){var n=document.forms.pp_user_api_patch_is_in_message_form;if(n!=null){var o={mode:p};k({method:"PATCH",url:n.action,data:JSON.stringify(o)}).then(function(q){},function(q){console.log("Request failed : "+q.statusText)})}};var i=function(){document.getElementById("notificationList").style.display="none";$("#notificationButton").removeClass("alert");$("#notificationButton").removeClass("open");document.getElementById("notificationsNb").innerHTML=0;var n=document.forms.pp_notification_api_patch_viewed_form;if(n!=null){var p=[];k({method:"PATCH",url:n.action,data:JSON.stringify(p)}).then(function(q){},function(q){console.log("Request failed : "+q.statusText)})}for(var o in m.notifications){if(m.notifications.hasOwnProperty(o)){m.notifications[o].isViewed=true}}notificationListIsOpen=false};this.showNotifications=function(){if(!notificationListIsOpen){d();document.getElementById("notificationList").style.display="block";$("#notificationButton").addClass("open");if(!l){var n=document.forms.pp_notification_api_get_notification_form;if(n!=null){k.get(n.action).then(function(p){j=p.data.showMoreApiUrl;for(var o=0;o<p.data.notifications.length;o++){m.notifications.push(p.data.notifications[o])}if(!p.data.showMore){m.showMoreNotification=false}l=true},function(o){console.log("Request failed : "+o.statusText)})}}notificationListIsOpen=true;userMenuIsOpen=false}else{d()}};this.showMoreNotifications=function(){if(notificationListIsOpen&&j!=null){k.get(j).then(function(o){j=o.data.showMoreApiUrl;for(var n=0;n<o.data.notifications.length;n++){m.notifications.push(o.data.notifications[n])}if(!o.data.showMore){m.showMoreNotification=false}},function(n){console.log("Request failed : "+n.statusText)})}};this.patchNotificationClicked=function(p){d();var n=m.notifications[p];var o=n.setClickedUrl;var q=[];if(!n.isCliked){k({method:"PATCH",url:o,data:JSON.stringify(q)}).then(function(r){},function(r){console.log("Request failed : "+r.statusText)})}if(n.type!=4){c.location.href=n.redirectUrl}else{this.showMessage();angular.element(document.getElementById("messageApp")).scope().$emit("showNewMessage",n.authorId)}};this.showUserMenu=function(){if(!userMenuIsOpen){d();document.getElementById("userMenu").style.display="block";userMenuIsOpen=true}else{d()}};var a=function(){document.getElementById("userMenu").style.display="none";userMenuIsOpen=false};this.showFilterList=function(){if(!filterListIsOpen){d();document.getElementById("filterList").style.display="block";filterListIsOpen=true;$("#filterButton").addClass("open")}else{f()}};var f=function(){if(filterListIsOpen){document.getElementById("filterList").style.display="none";$("#filterButton").removeClass("open");filterListIsOpen=false}document.getElementById("searchOptions").style.display="none"};this.showSearchOptions=function(){document.getElementById("searchOptions").style.display="block"};m.$on("notification",function(o,n){if(l){m.notifications.unshift(n.notification);m.$apply()}document.getElementById("notificationsNb").innerHTML=parseInt(document.getElementById("notificationsNb").innerHTML)+1;$("#notificationButton").addClass("alert")});$("html").click(function(){d()});$(".stopPropagation").click(function(n){n.stopPropagation()})}]);