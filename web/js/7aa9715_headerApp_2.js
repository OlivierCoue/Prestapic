var headerApp=angular.module("headerApp",[]);headerApp.config(["$locationProvider",function(a){a.html5Mode(true)}]);headerApp.service("FayeClient",function(){return new Faye.Client("http://localhost:3000/")});headerApp.run(["$rootScope","FayeClient","$http",function(a,e,f){a.notifications=[];var d=document.forms.pp_notification_api_get_thread_form;if(d!=null){var b=d.action;var c=null;f.get(b).then(function(g){var h=JSON.parse(g.data);c=h.notifThreadSlug;e.subscribe("/notification/"+c,function(i){a.$broadcast("notification",i)})},function(g){console.log("Request failed : "+g.statusText)})}}]);headerApp.filter("reverse",function(){return function(a){return a.slice().reverse()}});var notificationListIsOpen=false;var userMenuIsOpen=false;var filterListIsOpen=false;var haveOpenMessage=false;headerApp.controller("headerController",["$scope","$http","$compile","$location","$window",function(i,g,b,d,a){var h=false;var f=null;i.showMoreNotification=true;this.showMessage=function(){if(!haveOpenMessage){var j=document.getElementById("messageApp");if(j!=null){angular.element(document).ready(function(){angular.bootstrap(j,["messageApp"])});haveOpenMessage=true}}};var e=function(){document.getElementById("notificationList").style.display="none";$("#notificationButton").removeClass("alert");$("#notificationButton").removeClass("open");document.getElementById("notificationsNb").innerHTML=0;var j=document.forms.pp_notification_api_patch_viewed_form;if(j!=null){var l=[];g({method:"PATCH",url:j.action,data:JSON.stringify(l)}).then(function(m){},function(m){console.log("Request failed : "+m.statusText)})}for(var k in i.notifications){if(i.notifications.hasOwnProperty(k)){i.notifications[k].isViewed=true}}notificationListIsOpen=false};this.showNotifications=function(){if(!notificationListIsOpen){document.getElementById("notificationList").style.display="block";document.getElementById("userMenu").style.display="none";$("#notificationButton").addClass("open");c();if(!h){var j=document.forms.pp_notification_api_get_notification_form;if(j!=null){g.get(j.action).then(function(l){f=l.data.showMoreApiUrl;for(var k=0;k<l.data.notifications.length;k++){i.notifications.push(l.data.notifications[k])}if(!l.data.showMore){i.showMoreNotification=false}h=true},function(k){console.log("Request failed : "+k.statusText)})}}notificationListIsOpen=true;userMenuIsOpen=false}else{e()}};this.showMoreNotifications=function(){if(notificationListIsOpen&&f!=null){g.get(f).then(function(k){f=k.data.showMoreApiUrl;for(var j=0;j<k.data.notifications.length;j++){i.notifications.push(k.data.notifications[j])}if(!k.data.showMore){i.showMoreNotification=false}},function(j){console.log("Request failed : "+j.statusText)})}};this.patchNotificationClicked=function(l){e();var j=i.notifications[l];var k=j.setClickedUrl;var m=[];if(!j.isCliked){g({method:"PATCH",url:k,data:JSON.stringify(m)}).then(function(n){},function(n){console.log("Request failed : "+n.statusText)})}a.location.href=j.redirectUrl};this.showUserMenu=function(){if(!userMenuIsOpen){if(notificationListIsOpen){e()}document.getElementById("userMenu").style.display="block";document.getElementById("filterList").style.display="none";filterListIsOpen=false;userMenuIsOpen=true}else{document.getElementById("userMenu").style.display="none";userMenuIsOpen=false}};this.showFilterList=function(){if(!filterListIsOpen){if(notificationListIsOpen){e()}document.getElementById("filterList").style.display="block";document.getElementById("userMenu").style.display="none";userMenuIsOpen=false;filterListIsOpen=true;$("#filterButton").addClass("open")}else{c()}};var c=function(){if(filterListIsOpen){document.getElementById("filterList").style.display="none";$("#filterButton").removeClass("open");filterListIsOpen=false}document.getElementById("searchOptions").style.display="none"};this.showSearchOptions=function(){document.getElementById("searchOptions").style.display="block"};i.$on("notification",function(k,j){if(h){i.notifications.unshift(j.notification);i.$apply()}document.getElementById("notificationsNb").innerHTML=parseInt(document.getElementById("notificationsNb").innerHTML)+1;$("#notificationButton").addClass("alert")});$("html").click(function(){if(notificationListIsOpen){e()}if(document.getElementById("userMenu")!=null){document.getElementById("userMenu").style.display="none"}userMenuIsOpen=false;c()});$(".stopPropagation").click(function(j){j.stopPropagation()})}]);