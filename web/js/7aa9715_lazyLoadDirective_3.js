containerApp.directive("bnLazySrc",["$window","$document",function(f,d){function c(q){function l(u,s){if(!q.is(":visible")){return !1}null===g&&(g=q.height());var o=q.offset().top,n=o+g;return s>=o&&o>=u||s>=n&&n>=u||u>=o&&n>=s}function k(){p=!0,h()}function j(e){m=e,p&&h()}function h(){q[0].src=m}var m=null,p=!1,g=null;return{isVisible:l,render:k,setSource:j}}function b(j,h,g){var i=new c(h);a.addImage(i),g.$observe("bnLazySrc",function(e){i.setSource(e)}),j.$on("$destroy",function(){a.removeImage(i)})}var a=function(){function w(g){q.push(g),j||k(),e||B()}function n(h){for(var g=0;g<q.length;g++){if(q[g]===h){q.splice(g,1);break}}q.length||(H(),F())}function C(){if(!j){var g=I.height();g!==G&&(G=g,k())}}function y(){for(var K=[],v=[],s=E.height(),p=E.scrollTop(),m=p,z=m+s,h=0;h<q.length;h++){var g=q[h];g.isVisible(m,z)?K.push(g):v.push(g)}for(var h=0;h<K.length;h++){K[h].render()}q=v,H(),q.length||F()}function H(){clearTimeout(j),j=null}function k(){j=setTimeout(y,D)}function B(){e=!0,E.on("resize.bnLazySrc",J),E.on("scroll.bnLazySrc",J),A=setInterval(C,x)}function F(){e=!1,E.off("resize.bnLazySrc"),E.off("scroll.bnLazySrc"),clearInterval(A)}function J(){j||k()}var q=[],j=null,D=100,E=$(f),I=d,G=I.height(),A=null,x=2000,e=!1;return{addImage:w,removeImage:n}}();return{link:b,restrict:"A"}}]);