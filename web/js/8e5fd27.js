angular.element(document).ready(function(){var a=document.getElementById("containerApp");angular.bootstrap(a,["containerApp"])});var containerApp=angular.module("containerApp",["ngRoute"]);containerApp.config(["$locationProvider",function(a){a.html5Mode(true)}]);containerApp.controller("requestsController",["$scope","$http","$compile","$location",function(m,j,c,d){this.contentToDisplay=$("#contentToDisplaySelect").val();this.displayMode=$("#displayModeSelect").val();var l="?";var b="search_query=";var h="tags=";var n="categories=";var a="me=false";this.init=function(){if(d.search().search_query!=null){b+=d.search().search_query}if(d.search().tags!=null){h+=d.search().tags}if(d.search().categories!=null){n+=d.search().categories}if(d.search().me!=null){a="me=true"}l+=b+"&"+h+"&"+n+"&"+a;this.update()};var g="#loadPageTrigger2";var i=2;var e=function(p){var o=document.forms["pp_request_api_get_request_form_"+p].action;document.getElementById("loadingGif").style.display="block";j.get(o+".html"+l).then(function(q){var r=angular.element(q.data);c(r)(m);angular.element(document.querySelector("#loadPage"+p)).append(r);document.getElementById("loadingGif").style.display="none"},function(q){console.log("Request failed : "+q.statusText)})};this.update=function(){console.log(this.contentToDisplay);$("#loadPage1").html("");g="#loadPageTrigger2";i=2;l="?"+b+"&"+h+"&"+n+"&"+a+"&display_mode="+this.displayMode+"&content_to_display="+this.contentToDisplay;e(1)};var k=true;this.postRequestVote=function(q){if(k){k=false;$("#imageRequestUpvoteButton_"+q).addClass("voted");document.getElementById("imageRequestUpvoteButton_"+q).innerHTML=parseInt($("#imageRequestUpvoteButton_"+q).html())+1;var p={id:q};var o=document.forms.pp_request_api_patch_request_vote.action;j({method:"PATCH",url:o,data:JSON.stringify(p)}).then(function(r){k=true},function(r){console.log("Request failed : "+r.statusText);k=true})}};var f=true;this.postPropositionVote=function(o){if(f){f=false;$("#propositionUpvoteButton_"+o).addClass("voted");document.getElementById("propositionUpvoteButton_"+o).innerHTML=parseInt($("#propositionUpvoteButton_"+o).html())+1;var q={id:o};var p=document.forms.pp_proposition_api_patch_proposition_vote_form.action;j({method:"PATCH",url:p,data:JSON.stringify(q)}).then(function(r){f=true},function(r){console.log("Request failed : "+r.statusText);f=true})}};$(window).scroll(function(){if($(g).offset()!=null){var q=$(g).offset().top,r=$(g).outerHeight(),p=$(window).height(),o=$(this).scrollTop()}if(o>(q+r-p)){e(i);i++;g="#loadPageTrigger"+i}})}]);