var headerApp=angular.module("headerApp",[]);headerApp.config(["$locationProvider",function(a){a.html5Mode(true)}]);headerApp.service("FayeClient",function(){return new Faye.Client("http://alexandrejolly.com:3000/")});headerApp.run(["$rootScope","FayeClient","$http",function(a,e,f){a.notifications=[];var d=document.forms.pp_notification_api_get_thread_form;if(d!=null){var b=d.action;var c=null;f.get(b).then(function(g){var h=JSON.parse(g.data);c=h.notifThreadSlug;e.subscribe("/notification/"+c,function(i){a.$broadcast("notification",i)})},function(g){console.log("Request failed : "+g.statusText)})}}]);headerApp.filter("reverse",function(){return function(a){return a.slice().reverse()}});var notificationListIsOpen=false;var userMenuIsOpen=false;var filterListIsOpen=false;var haveOpenMessage=false;var messageIsOpen=false;headerApp.controller("headerController",["$scope","$http","$compile","$location","$window",function(n,l,f,i,d){$(".fixeBodyHover").mouseover(function(){$("#body").css("position","fixed")});$(".fixeBodyHover").mouseout(function(){$("#body").css("position","absolute")});var m=false;var k=null;n.showMoreNotification=true;var e=function(){if(messageIsOpen){c()}if(notificationListIsOpen){j()}if(filterListIsOpen){g()}if(userMenuIsOpen){a()}$("#searchUser").css("display","none")};this.showMessage=function(){e();var o=document.getElementById("messageApp");document.getElementById("body").style.position="fixed";if(o!=null){h(true);if(!haveOpenMessage){angular.element(document).ready(function(){angular.bootstrap(o,["messageApp"])});haveOpenMessage=true}o.style.display="block";messageIsOpen=true}};var c=function(){document.getElementById("body").style.position="relative";if(document.getElementById("messageApp")!=null){document.getElementById("messageApp").style.display="none"}h(false);messageIsOpen=false};var h=function(q){var o=document.forms.pp_user_api_patch_is_in_message_form;if(o!=null){var p={mode:q};l({method:"PATCH",url:o.action,data:JSON.stringify(p)}).then(function(r){},function(r){console.log("Request failed : "+r.statusText)})}};var j=function(){document.getElementById("notificationList").style.display="none";$("#notificationButton").removeClass("alert");$("#notificationButton").removeClass("open");document.getElementById("notificationsNb").innerHTML=0;var o=document.forms.pp_notification_api_patch_viewed_form;if(o!=null){var q=[];l({method:"PATCH",url:o.action,data:JSON.stringify(q)}).then(function(r){},function(r){console.log("Request failed : "+r.statusText)})}for(var p in n.notifications){if(n.notifications.hasOwnProperty(p)){n.notifications[p].isViewed=true}}notificationListIsOpen=false};this.showNotifications=function(){if(!notificationListIsOpen){e();document.getElementById("notificationList").style.display="block";$("#notificationButton").addClass("open");if(!m){var o=document.forms.pp_notification_api_get_notification_form;if(o!=null){l.get(o.action).then(function(q){$("#loadingNotif").css("display","none");k=q.data.showMoreApiUrl;if(q.data.notifications.length==0){$("#noNotification").css("display","block")}for(var p=0;p<q.data.notifications.length;p++){n.notifications.push(q.data.notifications[p])}if(!q.data.showMore){n.showMoreNotification=false}m=true},function(p){console.log("Request failed : "+p.statusText)})}}notificationListIsOpen=true;userMenuIsOpen=false}else{e()}};this.showMoreNotifications=function(){if(notificationListIsOpen&&k!=null){l.get(k).then(function(p){k=p.data.showMoreApiUrl;for(var o=0;o<p.data.notifications.length;o++){n.notifications.push(p.data.notifications[o])}if(!p.data.showMore){n.showMoreNotification=false}},function(o){console.log("Request failed : "+o.statusText)})}};this.patchNotificationClicked=function(r){e();var p=n.notifications[r];var q=p.setClickedUrl;var s=[];if(!p.isCliked){l({method:"PATCH",url:q,data:JSON.stringify(s)}).then(function(t){},function(t){console.log("Request failed : "+t.statusText)})}if(p.type!=4){d.location.href=p.redirectUrl}else{this.showMessage();var o={id:p.messageThreadId,target:{id:p.authorId,name:p.authorName,image:p.authorImg}};angular.element(document.getElementById("messageApp")).scope().$emit("showNewMessage",o)}};this.showUserMenu=function(){if(!userMenuIsOpen){e();document.getElementById("userMenu").style.display="block";userMenuIsOpen=true}else{e()}};var a=function(){document.getElementById("userMenu").style.display="none";userMenuIsOpen=false};this.showFilterList=function(){if(!filterListIsOpen){e();document.getElementById("filterList").style.display="block";filterListIsOpen=true;$("#filterButton").addClass("open")}else{g()}};var g=function(){if(filterListIsOpen){document.getElementById("filterList").style.display="none";$("#filterButton").removeClass("open");filterListIsOpen=false}document.getElementById("searchOptions").style.display="none"};this.showSearchOptions=function(){document.getElementById("searchOptions").style.display="block";$("#searchUser").css("display","block")};n.$on("notification",function(p,o){if(m){n.notifications.unshift(o.notification);n.$apply();$("#noNotification").css("display","none")}document.getElementById("notificationsNb").innerHTML=parseInt(document.getElementById("notificationsNb").innerHTML)+1;$("#notificationButton").addClass("alert")});$("html").click(function(){e()});$(".stopPropagation").click(function(o){o.stopPropagation()});function b(){function o(p){angular.element(document.getElementById("headerController")).scope().leave()}window.onbeforeunload=o}$(document).ready(function(){b()});n.leave=function(){e()}}]);headerApp.controller("filtersController",["$scope","$http","$compile","$location","$window",function(a,f,b,e,d){this.showFiltersTags=function(){c();document.getElementById("filtersTags").style.display="block";$("#filtersTagsButton").addClass("open")};this.showFiltersCat=function(){c();document.getElementById("filtersCat").style.display="block";$("#filtersCatButton").addClass("open")};var c=function(){document.getElementById("filtersTags").style.display="none";document.getElementById("filtersCat").style.display="none";$("#filtersCatButton").removeClass("open");$("#filtersTagsButton").removeClass("open")};this.categoriesList=[];this.addCategory=function(h,g){if(this.categoriesList[h]==null){this.categoriesList[h]=g}else{delete this.categoriesList[h]}};this.tagsListClicked=[];this.tagsListStr=null;this.tagList=[];this.addTag=function(h,g){if(this.tagsListClicked[h]==null){$("#tag_"+h).addClass("choosen");this.tagsListClicked[h]=g}else{$("#tag_"+h).removeClass("choosen");delete this.tagsListClicked[h]}};this.tagStrToArray=function(){var j=[];if(this.tagsListStr){this.tagsListStr=this.tagsListStr.toLowerCase()+",";this.tagsListStr=this.tagsListStr.replace(" ","");var i="";var h=this.tagsListStr.split("");h.forEach(function(k){if(k!=","){i+=k}else{if(i){j.push(i)}i=""}})}this.tagsListClicked.forEach(function(k){j.push(k)});var g=[];$.each(j,function(k,l){if($.inArray(l,g)===-1){g.push(l)}});this.tagList=g};this.conceringMe=false;this.searchQuery="";this.submitForm=function(){this.tagStrToArray();var m=document.getElementsByName("search_action")[0].value;var l="search_query="+this.searchQuery;var k="tags=";for(var h=0;h<this.tagList.length;h++){k+=this.tagList[h];if(h<this.tagList.length-1){k+="+"}}var g="categories=";for(var h=0;h<this.categoriesList.length;h++){if(this.categoriesList[h]){g+=this.categoriesList[h];if(h<this.categoriesList.length-1){g+="+"}}}var j="";if(this.conceringMe){j="me=true"}d.location.href=m+"?"+l+"&"+k+"&"+g+"&"+j}}]);